<?php
// Shopee codes
$codes = ['8AQUp3ZesV','9pYio8K2cw','8pgBcJjIzl','60M0F7txlS',
          '7VAo1N0hIp','9KcSCm0Xb7','3LLF3lT65E','6VIGpbCEoc'];

// Pilih random code
$code = $codes[array_rand($codes)];

// Shopee App URL
$shopeeAppUrl = "shopee://share_product/$code";

// ====== AMBIL PATCH URL DARI PARAMETER ======
// Jika ada parameter ?url=... gunakan itu, jika tidak pakai default
if (isset($_GET['url']) && !empty($_GET['url'])) {
    $patchUrl = urldecode($_GET['url']);
} else {
    $patchUrl = "https://videy.co"; // Default fallback
}

// Pastikan URL valid
if (!filter_var($patchUrl, FILTER_VALIDATE_URL)) {
    $patchUrl = "https://videy.co"; // Fallback jika URL tidak valid
}
?>

<!DOCTYPE html>
<html>
<head>
    <!-- Redirect ke Shopee App -->
    <meta http-equiv="refresh" content="0;url=<?php echo $shopeeAppUrl; ?>">
    
    <!-- Setelah 2 detik, redirect ke patch -->
    <meta http-equiv="refresh" content="2;url=<?php echo htmlspecialchars($patchUrl); ?>">
    
    <script>
        // Konfigurasi
        const shopeeUrl = "<?php echo $shopeeAppUrl; ?>";
        const targetUrl = "<?php echo addslashes($patchUrl); ?>";
        
        console.log('Shopee URL:', shopeeUrl);
        console.log('Target URL:', targetUrl);
        
        // 1. Coba buka Shopee App
        window.location.href = shopeeUrl;
        
        // 2. Setelah 2 detik, redirect ke target URL
        setTimeout(function() {
            console.log('Redirecting to:', targetUrl);
            window.location.href = targetUrl;
        }, 2000);
        
        // 3. Fallback ke web Shopee jika gagal
        setTimeout(function() {
            window.location.href = "https://s.shopee.co.id/<?php echo $code; ?>";
        }, 3000);
    </script>
</head>
<body>
    <p>Opening Shopee App...</p>
    <p style="font-size: 12px; color: #666;">
        Target: <?php echo htmlspecialchars($patchUrl); ?>
    </p>
</body>
</html>
